//---------------------------------------------------
//         *****!Do not edit this file!*****
//---------------------------------------------------
// Purpose: Only runs on first map load of session
//---------------------------------------------------

// Reset dev level
// Developer needs to stay enabled for VScript Debugging to work
if (Config_DevMode || Config_VScriptDebug) {
    EntFire("p2mm_servercommand", "command", "developer 1")
}
else {
    EntFire("p2mm_servercommand", "command", "clear; developer 0")
}

if (!PluginLoaded) {
    // Remove Portal Gun (Map transition will sound less abrupt)
    // Can't use UTIL_Team.Spawn_PortalGun(false) since the .nut file has not been loaded
    Entities.CreateByClassname("info_target").__KeyValueFromString("targetname", "supress_blue_portalgun_spawn")
    Entities.CreateByClassname("info_target").__KeyValueFromString("targetname", "supress_orange_portalgun_spawn")

    EntFire("p2mm_servercommand", "command", "script printl(\"(P2:MM VSCRIPT): FALLBACK! Attempting to load the P2:MM plugin through VScript!\")", 0.03)
    EntFire("p2mm_servercommand", "command", "plugin_load addons/p2mm", 0.05) // This should never fail the first time through addons... try loading it from root DLC path
} else {
    printlP2MM("Plugin has already been loaded! Not attempting to load it...")
}

EntFire("p2mm_servercommand", "command", "stopvideos; changelevel " + GetMapName(), 0.70) // Must be delayed. We use changelevel to restart the map because restart_level is locked by the plugin by default
